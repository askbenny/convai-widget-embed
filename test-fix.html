<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AskBenny Widget - Custom Element Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 1rem;
            background: #f9f9f9;
        }
        .container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 2rem 0;
            padding: 1.5rem;
            border: 2px dashed #ddd;
            border-radius: 8px;
        }
        .status {
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.25rem;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Custom Element Registration Fix Test</h1>
        
        <p>This page tests that the custom element registration error is fixed when loading multiple widgets or refreshing the page.</p>

        <div class="test-section">
            <h3>1. Single Widget Test</h3>
            <p>Load a single widget to establish baseline:</p>
            <button onclick="loadSingleWidget()">Load Single Widget</button>
            <div id="single-status"></div>
            <div id="single-widget" style="min-height: 100px; border: 1px dashed #ccc; padding: 1rem; margin: 1rem 0;"></div>
        </div>

        <div class="test-section">
            <h3>2. Multiple Widgets Test</h3>
            <p>Load multiple widgets to test for conflicts:</p>
            <button onclick="loadMultipleWidgets()">Load Multiple Widgets</button>
            <button onclick="clearMultipleWidgets()">Clear Widgets</button>
            <div id="multiple-status"></div>
            <div id="multiple-widgets"></div>
        </div>

        <div class="test-section">
            <h3>3. Reload Test</h3>
            <p>Test reloading widgets after they've been loaded:</p>
            <button onclick="reloadWidgets()">Reload All Widgets</button>
            <div id="reload-status"></div>
        </div>

        <div class="test-section">
            <h3>4. Script Status Check</h3>
            <button onclick="checkScriptStatus()">Check ElevenLabs Status</button>
            <div id="script-status"></div>
        </div>

        <div class="test-section">
            <h3>üìä Console Output</h3>
            <p>Check the browser console for any errors. The custom element registration error should NOT appear.</p>
            <div id="console-info" class="info">
                <strong>Expected:</strong> No "Failed to execute 'define' on 'CustomElementRegistry'" errors
            </div>
        </div>
    </div>

    <!-- Load the AskBenny widget -->
    <script src="./dist/askbenny-widget.umd.js"></script>

    <script>
        let widgetCounter = 0;

        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function loadSingleWidget() {
            try {
                const container = document.getElementById('single-widget');
                container.innerHTML = '';
                
                const widget = document.createElement('ask-benny');
                widget.setAttribute('agent-id', 'agent_01jym2zzfrecjr53vhcn8kg8gq');
                container.appendChild(widget);
                
                showStatus('single-status', '‚úÖ Single widget loaded successfully', 'success');
            } catch (error) {
                showStatus('single-status', `‚ùå Error loading single widget: ${error.message}`, 'error');
                console.error('Single widget error:', error);
            }
        }

        function loadMultipleWidgets() {
            try {
                const container = document.getElementById('multiple-widgets');
                container.innerHTML = '';
                
                // Create 3 widgets with different configurations
                for (let i = 0; i < 3; i++) {
                    const widgetDiv = document.createElement('div');
                    widgetDiv.style.cssText = 'margin: 1rem 0; padding: 1rem; border: 1px dashed #ccc; min-height: 80px;';
                    widgetDiv.innerHTML = `<h4>Widget ${i + 1}</h4>`;
                    
                    const widget = document.createElement('ask-benny');
                    widget.setAttribute('agent-id', 'agent_01jym2zzfrecjr53vhcn8kg8gq');
                    if (i === 1) widget.setAttribute('hide-branding', 'true');
                    widgetDiv.appendChild(widget);
                    
                    container.appendChild(widgetDiv);
                }
                
                showStatus('multiple-status', '‚úÖ Multiple widgets loaded successfully', 'success');
            } catch (error) {
                showStatus('multiple-status', `‚ùå Error loading multiple widgets: ${error.message}`, 'error');
                console.error('Multiple widgets error:', error);
            }
        }

        function clearMultipleWidgets() {
            document.getElementById('multiple-widgets').innerHTML = '';
            showStatus('multiple-status', '‚ÑπÔ∏è Multiple widgets cleared', 'info');
        }

        function reloadWidgets() {
            try {
                // Clear and reload all widgets
                clearMultipleWidgets();
                document.getElementById('single-widget').innerHTML = '';
                
                setTimeout(() => {
                    loadSingleWidget();
                    loadMultipleWidgets();
                    showStatus('reload-status', '‚úÖ Widgets reloaded successfully', 'success');
                }, 500);
            } catch (error) {
                showStatus('reload-status', `‚ùå Error reloading widgets: ${error.message}`, 'error');
                console.error('Reload error:', error);
            }
        }

        function checkScriptStatus() {
            try {
                const isLoaded = window.AskBennyWidget ? window.AskBennyWidget.isElevenLabsLoaded() : false;
                const customElementDefined = window.customElements && window.customElements.get('elevenlabs-convai');
                const scriptPresent = document.querySelector('script[src*="elevenlabs"]');
                const globalFlag = !!window.__EL_CONVAI_LOADED__;
                
                let status = `
                    <strong>ElevenLabs Status:</strong><br>
                    ‚Ä¢ Custom Element Defined: ${customElementDefined ? '‚úÖ Yes' : '‚ùå No'}<br>
                    ‚Ä¢ Script Present: ${scriptPresent ? '‚úÖ Yes' : '‚ùå No'}<br>
                    ‚Ä¢ Global Flag: ${globalFlag ? '‚úÖ Yes' : '‚ùå No'}<br>
                    ‚Ä¢ Widget Reports Ready: ${isLoaded ? '‚úÖ Yes' : '‚ùå No'}
                `;
                
                showStatus('script-status', status, isLoaded ? 'success' : 'info');
            } catch (error) {
                showStatus('script-status', `‚ùå Error checking status: ${error.message}`, 'error');
                console.error('Status check error:', error);
            }
        }

        // Listen for errors
        window.addEventListener('error', function(e) {
            if (e.message.includes('CustomElementRegistry')) {
                console.error('‚ùå CUSTOM ELEMENT REGISTRATION ERROR DETECTED:', e.message);
                document.body.style.background = '#ffe6e6';
            }
        });

        // Log when page loads
        window.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ Custom Element Fix Test Page Loaded');
            console.log('üìù This page tests that custom element registration errors are fixed');
            console.log('üîç Watch the console for any registration errors');
            
            // Auto-run basic test
            setTimeout(() => {
                loadSingleWidget();
            }, 1000);
        });
    </script>
</body>
</html> 